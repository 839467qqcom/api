# 🚀 快速开始 - 并发执行功能

## ⚡ 5 分钟上手指南

### 📦 步骤 1：安装依赖

```bash
cd pytestApi
pip install -r requirements.txt
```

**新增依赖：**
- `pandas>=1.5.0` - 用于 CSV 数据支持
- `pytest-xdist>=2.5.0` - 用于用例级并发（可选）

---

### 🏃 步骤 2：运行并发测试

```bash
python run.py
```

**操作流程：**
```
1. 选择模式 → 输入 2（并发模式）
2. 选择文件 → 输入 all 或 1,3,5-8
3. 设置并发数 → 直接回车（使用推荐值）或输入数字
4. 确认执行 → 输入 y
5. 等待完成 → 查看执行摘要
6. 打开报告 → 输入 y
```

---

### 💡 快速示例

#### **示例 1：全量并发执行**

```bash
$ python run.py
请选择模式 (1/2): 2
请选择: all              # 选择所有文件
请输入并发数: [回车]      # 使用推荐值
是否开始执行? (y/n): y
```

#### **示例 2：选择性并发执行**

```bash
$ python run.py
请选择模式 (1/2): 2
请选择: 1,3,5-8          # 选择指定文件
请输入并发数: 4          # 自定义并发数
是否开始执行? (y/n): y
```

#### **示例 3：按业务模块执行**

```bash
$ python run.py
请选择模式 (1/2): 2
请选择: group            # 按业务模块选择
请选择业务模块编号: 1,3  # 选择用户管理和商品管理
请输入并发数: [回车]
是否开始执行? (y/n): y
```

---

## 📊 预期效果

### **执行进度显示**
```
============================================================
🚀 启动并发执行引擎
============================================================
   📊 文件数: 5
   ⚙️  并发数: 4
   📁 结果目录: TestReport/temp_results
============================================================

🚀 开始执行: 用户管理.xlsx (Worker 0)
🚀 开始执行: 订单管理.xlsx (Worker 1)
🚀 开始执行: 商品管理.xlsx (Worker 2)
🚀 开始执行: 插件管理.xlsx (Worker 3)

[1/5] ✅ 通过 | 用户管理.xlsx                     | 耗时: 42.3s
[2/5] ✅ 通过 | 订单管理.xlsx                     | 耗时: 45.1s
[3/5] ✅ 通过 | 商品管理.xlsx                     | 耗时: 38.7s
[4/5] ✅ 通过 | 插件管理.xlsx                     | 耗时: 51.2s
[5/5] ✅ 通过 | 系统设置.xlsx                     | 耗时: 35.8s

============================================================
✅ 并发执行完成
============================================================
```

### **执行摘要**
```
============================================================
📊 执行摘要
============================================================
  📦 总文件数: 5
  ✅ 成功: 5
  ❌ 失败: 0
  📈 成功率: 100.0%
  ⏱️  总耗时: 213.12s (3.6 分钟)
  🚀 平均耗时: 42.62s/文件
============================================================
```

---

## ⚙️ 配置调整（可选）

如需调整默认配置，编辑 `config/base.yaml`：

```yaml
concurrent:
  enabled: true                    # 启用/禁用并发功能
  default_max_workers: 4           # 设置默认并发数
  timeout: 600                     # 调整超时时间
  cleanup_worker_logs: false       # 保留 worker 日志（用于调试）
```

---

## 🎯 性能对比

| 测试文件数 | 串行耗时 | 并发耗时（4核） | 性能提升 |
|-----------|---------|---------------|---------|
| 4 个 | 3 分钟 | 45 秒 | **4x** 🚀 |
| 8 个 | 6 分钟 | 1.5 分钟 | **4x** 🚀 |
| 16 个 | 12 分钟 | 3 分钟 | **4x** 🚀 |

---

## ⚠️ 重要提示

### **✅ 适用场景**
- 全量回归测试
- 多模块独立测试
- 测试用例无依赖关系

### **❌ 不适用场景**
- 用例之间有强依赖
- 测试数据有冲突
- 系统资源受限

### **💡 最佳实践**
1. **首次使用**：先选择 2-3 个文件测试
2. **并发数设置**：建议使用推荐值或 CPU 核心数
3. **失败处理**：失败后先用标准模式单独运行该文件
4. **资源监控**：注意 CPU 和内存使用率

---

## 📝 文件选择技巧

### **方式 1：编号选择**
- `1` - 选择第 1 个文件
- `1,3,5` - 选择多个文件
- `1-5` - 选择范围
- `1,3-5,8` - 组合选择

### **方式 2：全选**
- `all` - 选择所有文件

### **方式 3：业务模块**
- `group` - 显示业务模块分组
- 然后选择模块编号

---

## 🆘 遇到问题？

### **问题 1：某些文件失败**
```bash
# 单独运行失败的文件（标准模式）
python run.py
选择模式: 1
# 查看详细错误信息
```

### **问题 2：执行很慢**
```bash
# 减少并发数
并发数: 2  # 而不是 4 或 8
```

### **问题 3：需要查看日志**
```bash
# 修改 config/base.yaml
cleanup_worker_logs: false

# 然后查看
log/log.worker_0
log/log.worker_1
```

---

## 📖 更多文档

详细文档请参考：[并发执行使用说明.md](./并发执行使用说明.md)

---

**Happy Testing! 🎉**

